{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jstef/Code/deiscord-activity-test-1/vercel/src/lib/mongodb.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\r\n\r\nlet client: MongoClient | null = null;\r\nlet clientPromise: Promise<MongoClient> | null = null;\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var _mongoClientPromise: Promise<MongoClient> | undefined;\r\n}\r\n\r\nfunction getMongoUri(): string {\r\n  const uri = process.env.MONGODB_URI;\r\n  if (!uri) {\r\n    // IMPORTANT: do NOT throw at module-eval time.\r\n    // Next.js may evaluate route modules during build.\r\n    throw new Error(\r\n      \"Missing MONGODB_URI. Set it in Vercel Project Settings â†’ Environment Variables.\",\r\n    );\r\n  }\r\n  // Log the URI (with password masked) for debugging\r\n  const maskedUri = uri.replace(/:[^:@]+@/, \":****@\");\r\n  console.log(\"[MongoDB] Connecting with URI:\", maskedUri);\r\n  return uri;\r\n}\r\n\r\nasync function getClient(): Promise<MongoClient> {\r\n  const uri = getMongoUri();\r\n  \r\n  // Verify URI format before creating client\r\n  if (!uri.includes('mongodb+srv://') && !uri.includes('mongodb://')) {\r\n    throw new Error(`Invalid MongoDB URI format: ${uri.substring(0, 50)}...`);\r\n  }\r\n  \r\n  // Check if password is properly encoded (should not contain unencoded @)\r\n  const uriMatch = uri.match(/mongodb\\+srv:\\/\\/[^:]+:([^@]+)@/);\r\n  if (uriMatch && uriMatch[1].includes('@') && !uriMatch[1].includes('%40')) {\r\n    throw new Error('MongoDB password contains unencoded @ character. Please URL-encode the password.');\r\n  }\r\n\r\n  if (process.env.NODE_ENV === \"development\") {\r\n    // Always create a fresh connection in development to pick up env changes\r\n    if (global._mongoClientPromise) {\r\n      try {\r\n        const oldClient = await global._mongoClientPromise;\r\n        await oldClient.close();\r\n      } catch (e) {\r\n        // Ignore errors when closing old client\r\n      }\r\n    }\r\n    client = new MongoClient(uri);\r\n    global._mongoClientPromise = client.connect();\r\n    return global._mongoClientPromise;\r\n  }\r\n\r\n  if (!clientPromise) {\r\n    client = new MongoClient(uri);\r\n    clientPromise = client.connect();\r\n  }\r\n\r\n  return clientPromise;\r\n}\r\n\r\nexport async function getDb() {\r\n  const c = await getClient();\r\n  return c.db(process.env.DB_NAME || undefined);\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,SAA6B;AACjC,IAAI,gBAA6C;AAOjD,SAAS;IACP,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;IACnC,IAAI,CAAC,KAAK;QACR,+CAA+C;QAC/C,mDAAmD;QACnD,MAAM,IAAI,MACR;IAEJ;IACA,mDAAmD;IACnD,MAAM,YAAY,IAAI,OAAO,CAAC,YAAY;IAC1C,QAAQ,GAAG,CAAC,kCAAkC;IAC9C,OAAO;AACT;AAEA,eAAe;IACb,MAAM,MAAM;IAEZ,2CAA2C;IAC3C,IAAI,CAAC,IAAI,QAAQ,CAAC,qBAAqB,CAAC,IAAI,QAAQ,CAAC,eAAe;QAClE,MAAM,IAAI,MAAM,CAAC,4BAA4B,EAAE,IAAI,SAAS,CAAC,GAAG,IAAI,GAAG,CAAC;IAC1E;IAEA,yEAAyE;IACzE,MAAM,WAAW,IAAI,KAAK,CAAC;IAC3B,IAAI,YAAY,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,CAAC,QAAQ;QACzE,MAAM,IAAI,MAAM;IAClB;IAEA,wCAA4C;QAC1C,yEAAyE;QACzE,IAAI,OAAO,mBAAmB,EAAE;YAC9B,IAAI;gBACF,MAAM,YAAY,MAAM,OAAO,mBAAmB;gBAClD,MAAM,UAAU,KAAK;YACvB,EAAE,OAAO,GAAG;YACV,wCAAwC;YAC1C;QACF;QACA,SAAS,IAAI,oKAAW,CAAC;QACzB,OAAO,mBAAmB,GAAG,OAAO,OAAO;QAC3C,OAAO,OAAO,mBAAmB;IACnC;;;AAQF;AAEO,eAAe;IACpB,MAAM,IAAI,MAAM;IAChB,OAAO,EAAE,EAAE,CAAC,QAAQ,GAAG,CAAC,OAAO,IAAI;AACrC"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jstef/Code/deiscord-activity-test-1/vercel/src/lib/seed.ts"],"sourcesContent":["import { randomUUID } from \"crypto\";\r\nimport type { InventoryItem, Rarity, SlotKey } from \"@/lib/types\";\r\n\r\nexport const RARITY_WEIGHT: Record<Rarity, number> = {\r\n  common: 1,\r\n  epic: 2,\r\n  legendary: 3,\r\n};\r\n\r\nfunction item(\r\n  slot: SlotKey,\r\n  name: string,\r\n  rarity: Rarity,\r\n  stat_bonus: InventoryItem[\"stat_bonus\"],\r\n): InventoryItem {\r\n  return {\r\n    item_id: randomUUID(),\r\n    slot,\r\n    name,\r\n    rarity,\r\n    stat_bonus,\r\n  };\r\n}\r\n\r\nexport function seedInventory(): InventoryItem[] {\r\n  return [\r\n    item(\"head\", \"Neural Visor Mk.I\", \"common\", { intelligence: 1 }),\r\n    item(\"head\", \"Cyan Halo Helm\", \"epic\", { mind: 2 }),\r\n    item(\"head\", \"Legend Crown Interface\", \"legendary\", {\r\n      intelligence: 3,\r\n      mind: 2,\r\n    }),\r\n    item(\"shoulders\", \"Reactive Pauldrons\", \"common\", { vitality: 1 }),\r\n    item(\"shoulders\", \"Aegis Spines\", \"epic\", { vitality: 2, strength: 1 }),\r\n    item(\"shoulders\", \"Singularity Mantle\", \"legendary\", {\r\n      vitality: 3,\r\n      strength: 2,\r\n    }),\r\n    item(\"chest\", \"Carbon Weave Core\", \"common\", { vitality: 1, strength: 1 }),\r\n    item(\"chest\", \"Vector Plating\", \"epic\", { vitality: 2, dexterity: 1 }),\r\n    item(\"chest\", \"Titanium Heart Engine\", \"legendary\", {\r\n      vitality: 4,\r\n      strength: 2,\r\n    }),\r\n    item(\"hands\", \"Servo Gloves\", \"common\", { dexterity: 1 }),\r\n    item(\"hands\", \"Arc Gauntlets\", \"epic\", { strength: 1, dexterity: 2 }),\r\n    item(\"hands\", \"Chrono Hands\", \"legendary\", { dexterity: 3, intelligence: 1 }),\r\n    item(\"legs\", \"Kinetic Greaves\", \"common\", { vitality: 1 }),\r\n    item(\"legs\", \"Stride Amplifiers\", \"epic\", { dexterity: 2, vitality: 1 }),\r\n    item(\"legs\", \"Voidwalk Legs\", \"legendary\", { dexterity: 3, mind: 1 }),\r\n    item(\"feet\", \"Mag Boots\", \"common\", { dexterity: 1 }),\r\n    item(\"feet\", \"Phase Runners\", \"epic\", { dexterity: 2, mind: 1 }),\r\n    item(\"feet\", \"Stellar Treads\", \"legendary\", { dexterity: 3, vitality: 1 }),\r\n    item(\"main_hand\", \"Pulse Blade\", \"common\", { strength: 1 }),\r\n    item(\"main_hand\", \"Rail Pistol\", \"epic\", { dexterity: 1, strength: 2 }),\r\n    item(\"main_hand\", \"Cyan Edge Prototype\", \"legendary\", { strength: 4 }),\r\n    item(\"off_hand\", \"Buckler Drone\", \"common\", { vitality: 1 }),\r\n    item(\"off_hand\", \"Ion Shield\", \"epic\", { vitality: 2, mind: 1 }),\r\n    item(\"off_hand\", \"Prismatic Barrier\", \"legendary\", {\r\n      vitality: 3,\r\n      intelligence: 1,\r\n      mind: 1,\r\n    }),\r\n  ];\r\n}\r\n\r\nexport function emptyEquipped(): Record<string, null> {\r\n  return {\r\n    head: null,\r\n    shoulders: null,\r\n    chest: null,\r\n    hands: null,\r\n    legs: null,\r\n    feet: null,\r\n    main_hand: null,\r\n    off_hand: null,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAGO,MAAM,gBAAwC;IACnD,QAAQ;IACR,MAAM;IACN,WAAW;AACb;AAEA,SAAS,KACP,IAAa,EACb,IAAY,EACZ,MAAc,EACd,UAAuC;IAEvC,OAAO;QACL,SAAS,IAAA,mHAAU;QACnB;QACA;QACA;QACA;IACF;AACF;AAEO,SAAS;IACd,OAAO;QACL,KAAK,QAAQ,qBAAqB,UAAU;YAAE,cAAc;QAAE;QAC9D,KAAK,QAAQ,kBAAkB,QAAQ;YAAE,MAAM;QAAE;QACjD,KAAK,QAAQ,0BAA0B,aAAa;YAClD,cAAc;YACd,MAAM;QACR;QACA,KAAK,aAAa,sBAAsB,UAAU;YAAE,UAAU;QAAE;QAChE,KAAK,aAAa,gBAAgB,QAAQ;YAAE,UAAU;YAAG,UAAU;QAAE;QACrE,KAAK,aAAa,sBAAsB,aAAa;YACnD,UAAU;YACV,UAAU;QACZ;QACA,KAAK,SAAS,qBAAqB,UAAU;YAAE,UAAU;YAAG,UAAU;QAAE;QACxE,KAAK,SAAS,kBAAkB,QAAQ;YAAE,UAAU;YAAG,WAAW;QAAE;QACpE,KAAK,SAAS,yBAAyB,aAAa;YAClD,UAAU;YACV,UAAU;QACZ;QACA,KAAK,SAAS,gBAAgB,UAAU;YAAE,WAAW;QAAE;QACvD,KAAK,SAAS,iBAAiB,QAAQ;YAAE,UAAU;YAAG,WAAW;QAAE;QACnE,KAAK,SAAS,gBAAgB,aAAa;YAAE,WAAW;YAAG,cAAc;QAAE;QAC3E,KAAK,QAAQ,mBAAmB,UAAU;YAAE,UAAU;QAAE;QACxD,KAAK,QAAQ,qBAAqB,QAAQ;YAAE,WAAW;YAAG,UAAU;QAAE;QACtE,KAAK,QAAQ,iBAAiB,aAAa;YAAE,WAAW;YAAG,MAAM;QAAE;QACnE,KAAK,QAAQ,aAAa,UAAU;YAAE,WAAW;QAAE;QACnD,KAAK,QAAQ,iBAAiB,QAAQ;YAAE,WAAW;YAAG,MAAM;QAAE;QAC9D,KAAK,QAAQ,kBAAkB,aAAa;YAAE,WAAW;YAAG,UAAU;QAAE;QACxE,KAAK,aAAa,eAAe,UAAU;YAAE,UAAU;QAAE;QACzD,KAAK,aAAa,eAAe,QAAQ;YAAE,WAAW;YAAG,UAAU;QAAE;QACrE,KAAK,aAAa,uBAAuB,aAAa;YAAE,UAAU;QAAE;QACpE,KAAK,YAAY,iBAAiB,UAAU;YAAE,UAAU;QAAE;QAC1D,KAAK,YAAY,cAAc,QAAQ;YAAE,UAAU;YAAG,MAAM;QAAE;QAC9D,KAAK,YAAY,qBAAqB,aAAa;YACjD,UAAU;YACV,cAAc;YACd,MAAM;QACR;KACD;AACH;AAEO,SAAS;IACd,OAAO;QACL,MAAM;QACN,WAAW;QACX,OAAO;QACP,OAAO;QACP,MAAM;QACN,MAAM;QACN,WAAW;QACX,UAAU;IACZ;AACF"}},
    {"offset": {"line": 240, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jstef/Code/deiscord-activity-test-1/vercel/src/app/api/profile/upsert/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { getDb } from \"@/lib/mongodb\";\r\nimport { emptyEquipped, seedInventory } from \"@/lib/seed\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const body = await req.json();\r\n    const { discord_user_id, username, avatar } = body || {};\r\n\r\n    if (!discord_user_id || !username) {\r\n      return NextResponse.json(\r\n        { error: \"discord_user_id and username are required\" },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    const db = await getDb();\r\n    const profiles = db.collection(\"profiles\");\r\n\r\n    const now = new Date().toISOString();\r\n\r\n    const existing = await profiles.findOne({ discord_user_id });\r\n    if (existing) {\r\n      await profiles.updateOne(\r\n        { discord_user_id },\r\n        { $set: { username, avatar: avatar ?? null, updated_at: now } },\r\n      );\r\n      const updated = await profiles.findOne(\r\n        { discord_user_id },\r\n        { projection: { _id: 0 } },\r\n      );\r\n      return NextResponse.json(updated);\r\n    }\r\n\r\n    const newProfile = {\r\n      discord_user_id,\r\n      username,\r\n      avatar: avatar ?? null,\r\n      created_at: now,\r\n      updated_at: now,\r\n      base_stats: {\r\n        strength: 10,\r\n        vitality: 10,\r\n        dexterity: 10,\r\n        intelligence: 10,\r\n        mind: 10,\r\n      },\r\n      inventory: seedInventory(),\r\n      equipped: emptyEquipped(),\r\n    };\r\n\r\n    await profiles.insertOne(newProfile);\r\n\r\n    return NextResponse.json(newProfile);\r\n  } catch (error) {\r\n    console.error(\"Profile upsert error:\", error);\r\n    const errorMessage = error instanceof Error ? error.message : \"Internal server error\";\r\n    const errorStack = error instanceof Error ? error.stack : undefined;\r\n    console.error(\"Error stack:\", errorStack);\r\n    return NextResponse.json(\r\n      { error: errorMessage, details: errorStack },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,eAAe,EAAE,QAAQ,EAAE,MAAM,EAAE,GAAG,QAAQ,CAAC;QAEvD,IAAI,CAAC,mBAAmB,CAAC,UAAU;YACjC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,KAAK,MAAM,IAAA,gIAAK;QACtB,MAAM,WAAW,GAAG,UAAU,CAAC;QAE/B,MAAM,MAAM,IAAI,OAAO,WAAW;QAElC,MAAM,WAAW,MAAM,SAAS,OAAO,CAAC;YAAE;QAAgB;QAC1D,IAAI,UAAU;YACZ,MAAM,SAAS,SAAS,CACtB;gBAAE;YAAgB,GAClB;gBAAE,MAAM;oBAAE;oBAAU,QAAQ,UAAU;oBAAM,YAAY;gBAAI;YAAE;YAEhE,MAAM,UAAU,MAAM,SAAS,OAAO,CACpC;gBAAE;YAAgB,GAClB;gBAAE,YAAY;oBAAE,KAAK;gBAAE;YAAE;YAE3B,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC3B;QAEA,MAAM,aAAa;YACjB;YACA;YACA,QAAQ,UAAU;YAClB,YAAY;YACZ,YAAY;YACZ,YAAY;gBACV,UAAU;gBACV,UAAU;gBACV,WAAW;gBACX,cAAc;gBACd,MAAM;YACR;YACA,WAAW,IAAA,qIAAa;YACxB,UAAU,IAAA,qIAAa;QACzB;QAEA,MAAM,SAAS,SAAS,CAAC;QAEzB,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,MAAM,aAAa,iBAAiB,QAAQ,MAAM,KAAK,GAAG;QAC1D,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAc,SAAS;QAAW,GAC3C;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}